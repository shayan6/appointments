<div class="elementor-inner">
  <div class="elementor-section-wrap">
    <section class="elementor-element elementor-element-27d2474 elementor-section-full_width elementor-section-height-full elementor-section-content-top elementor-section-items-top elementor-section-height-default elementor-section elementor-top-section" data-id="27d2474" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
      <div class="elementor-container elementor-column-gap-default">
        <div class="elementor-row">
          <div class="elementor-element elementor-element-7cac455 elementor-column elementor-col-100 elementor-top-column" data-id="7cac455" data-element_type="column">
            <div class="elementor-column-wrap  elementor-element-populated">
              <div class="elementor-widget-wrap">
                <div class="elementor-element elementor-element-ae9385b elementor-widget elementor-widget-html" data-id="ae9385b" data-element_type="widget" data-widget_type="html.default">
                  <div class="elementor-widget-container">
                    <div style="display: flex; width: 100%; height 100; justify-content: center; align-items: center; margin-top: 10px;">
                      <div id="progress" class="progress_waiting progress_done">
                        <dt></dt>
                        <dd></dd>
                      </div>
                      <div class="appointment" id="theme_1">

                        <div class="appointment_steps">
                          <div class="appointment_steps_body" id="appointment_steps_body">
                            <!-- appointment_steps_body will render here -->
                          </div>
                          <div class="appointment_steps_footer" style="display: block;">
                            <div class="appointment_steps_footer_txt1"></div>
                            <div class="appointment_steps_footer_txt2"></div>
                          </div>
                        </div>

                        <div class="appointment_container">
                          
                          <div class="appointment_container_header">
                            <div class="row">
                              <div class="col-8 col-sm-12 col-lg-12">
                                <div id="appointment_container_header">
                                  Select
                                </div>
                              </div>
                              <div class="col-4 col-sm-12 col-lg-12">
                                <button type="button" class="btn_secondary prev_step d-block d-sm-none d-lg-none" style="margin: -6px;margin-left: auto;"> < </button>
                              </div>
                            </div>
                          </div>
                          
                          <div class="appointment_container_body" tabindex="1">

                            <!-- begin::pre loader card boxes  -->
                            <div class="preloader_card1_box hidden">
                              <div class="preloader_card1">
                                <div class="preloader_card1_image"></div>
                                <div class="preloader_card1_description"></div>
                              </div>
                              <div class="preloader_card1">
                                <div class="preloader_card1_image"></div>
                                <div class="preloader_card1_description"></div>
                              </div>
                              <div class="preloader_card1">
                                <div class="preloader_card1_image"></div>
                                <div class="preloader_card1_description"></div>
                              </div>
                            </div>
                            <div class="preloader_card2_box hidden">
                              <div class="preloader_card2">
                                <div class="preloader_card2_image"></div>
                                <div class="preloader_card2_description"></div>
                              </div>
                              <div class="preloader_card2">
                                <div class="preloader_card2_image"></div>
                                <div class="preloader_card2_description"></div>
                              </div>
                              <div class="preloader_card2">
                                <div class="preloader_card2_image"></div>
                                <div class="preloader_card2_description"></div>
                              </div>
                            </div>
                            <div class="preloader_card3_box hidden">
                              <div class="preloader_card3"></div>
                              <div class="preloader_card3"></div>
                              <div class="preloader_card3"></div>
                              <div class="preloader_card3"></div>
                            </div>
                            <!-- end::pre loader card boxes  -->

                            <div id="card_location" class="card_section hidden"></div>

                            <div id="card_staff" class="card_section hidden"></div>

                            <div id="card_service" class="card_section hidden"></div>

                            <div id="card_datetime" class="card_section hidden">
                              <div class="date_time_area">
                                <div class="calendar_div">
                                  <div class="calendar_head">
                                    <div class="prev_month"> &lt; </div>
                                    <div class="month_name"></div>
                                    <div class="next_month"> &gt; </div>
                                  </div>
                                  <div id="calendar_area">

                                  </div>
                                </div>
                                <div class="time_div">
                                  <div class="times_head">Time</div>
                                  <div class="times">
                                    <div class="times_title">Select date</div>
                                    <div class="times_list clearfix" style="overflow: hidden; outline: none;" tabindex="2">
                                      <div data-time="09:00" data-endtime="10:00">
                                        <div>09:00</div>
                                        <div>10:00</div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div id="card_information" class="card_section hidden">
                              <form id="form_information" action="" autocomplete="off">
                                <div class="row">
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-speech mr-1"></i> First Name</label>
                                      <input type="text" class="input-1" id="first_name" name="first_name" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-speech mr-1"></i> Last Name</label>
                                      <input type="text" class="input-1" id="last_name" name="last_name" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required focus">
                                      <label class="input-label"> <i class="icon-calendar mr-1"></i> Date Of Birth</label>
                                      <input type="text" class="input-1" id="date_of_birth" name="date_of_birth" value="09/24/2000" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-flag mr-1"></i> Nationality</label>
                                      <input type="text" class="input-1" id="nationality" name="nationality" required="required" />
                                      <input type="hidden" id="country_id" name="country_id" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-screen-smartphone mr-1"></i> Mobile Number</label>
                                      <input type="text" class="input-1" id="mobile_number" name="mobile_number" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-location-pin mr-1"></i> Emirates</label>
                                      <select class="input-1" id="emirates" name="emirates" required="required">
                                        <option></option>
                                        <option>Abu Dhabi</option>
                                        <option>Ajman</option>
                                        <option>Dubai</option>
                                        <option>Fujairah</option>
                                        <option>Ras Al Khaimah</option>
                                        <option>Sharjah</option>
                                        <option>Umm Al Quwain</option>
                                      </select>
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-envelope mr-1"></i> Email</label>
                                      <input type="text" class="input-1" id="email" name="email" required="required" />
                                    </div>
                                  </div>
                                  <div class="col-12 col-sm-6 col-lg-6">
                                    <div class="input-box required">
                                      <label class="input-label"> <i class="icon-people mr-1"></i> Marital status</label>
                                      <select class="input-1" id="marital_status" name="marital_status" required="required">
                                        <option></option>
                                        <option value="single">Single</option>
                                        <option value="married">Married</option>
                                      </select>
                                    </div>
                                  </div>
                                </div>
                                <button type="submit" class="hide"></button>
                              </form>
                            </div>

                            <div id="card_confirm_details" class="card_section hidden"></div>

                            <div class="appointment_finished_with_error hidden">
                              <img src="<?= base_url() ?>/assets/img/payment-error.svg">
                              <div>We arenâ€™t able to process your payment. Please, try again.</div>
                            </div>
                          </div>

                          <div class="appointment_container_footer">
                            <button type="button" class="btn_secondary prev_step">BACK</button>
                            <div class="warning_message"></div>
                            <button type="button" class="btn_primary next_step">NEXT STEP</button>
                            <button type="button" class="btn_success hidden confirm_appointment">CONFIRM APPOINMENT</button>
                            <button type="button" class="btn_primary hidden try_again_btn">TRY AGAIN</button>
                          </div>
                        </div>
                        <div class="appointment_finished">
                          <div class="appointment_finished_icon"><img src="<?= base_url() ?>/assets/img/icons/status-ok.svg">
                          </div>
                          <div class="appointment_finished_title">Thank you for your request!</div>
                          <div class="appointment_finished_subtitle">Your confirmation number:</div>
                          <div class="appointment_finished_code">919855</div>
                          <div class="appointment_finished_actions">
                            <button type="button" id="start_new_booking_btn" class="btn_secondary"><img src="<?= base_url() ?>/assets/img/icons/plus.svg">
                              START NEW BOOKING</button>
                            <button type="button" id="finish_btn" class="btn_secondary" data-redirect-url=""><img src="<?= base_url() ?>/assets/img/icons/check-small.svg">
                              FINISH BOOKING</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- ################################################################################### -->
<!-- render elements ################################################################### -->
<!-- ################################################################################### -->
<script type="text/html" id="tmpl_appointment_steps_body">
  <div class="appointment_step_element {{priority_active:sno}}" id="step_{{:step_name}}" data-step-id="{{:step_name}}" data-loader="card_{{:priority}}" data-title="Select {{:step_name}}" style="display: block;">
    <span class="badge">{{:sno}}</span>
    <span class="step_title"> {{:step_name}}</span>
  </div>
</script>

<script type="text/html" id="tmpl_card_location">
  <div class="card item" data-id="{{:location_id}}" style="display: flex;">
    <a class="card_image" href="javascript:;">
      <img src="<?= base_url() ?>/assets/img/locations/{{:location_image_name}}">
    </a>
    <div class="card_title">
      <div>{{:location_name}}</div>
      <div class="card_description">{{:location_address}}</div>
    </div>
  </div>
</script>

<script type="text/html" id="tmpl_card_staff">
  <div class="card item" data-id="{{:staff_id}}" style="display: flex;">
    <div class="card_image">
      <img src="<?= base_url() ?>/assets/img/staff/{{:image_file_name}}">
    </div>
    <div class="card_title">
      <div>{{:first_name}} {{:last_name}} </div>
      <div class="card_description">
        <div>{{:email_address}}</div>
        <div>{{:mobile_number}}</div>
      </div>
    </div>
  </div>
</script>

<script type="text/html" id="tmpl_card_service">
  <div class="service_card item" data-id="{{:service_id}}" data-is-recurring="0" data-has-extras="false" style="display: block;">
    <div class="service_card_image">
      <img src="<?= base_url() ?>/assets/img/services/no_image.png">
    </div>
    <div class="service_card_title">
      <span>{{:service_name}}</span>
      <span>{{:service_duration}}</span>
    </div>
    <div class="service_card_description">
    </div>
    <div class="service_card_price">
      AED {{:service_price}}
    </div>
  </div>
</script>

<!-- ################################################################################### -->
<!-- script page ####################################################################### -->
<!-- ################################################################################### -->
<script type="text/javascript" src="<?= base_url() ?>/assets/js/_home.js"></script>

<script>
  $(document).ready(function() {

    $.ajax({
      type: "GET",
      url: `${baseURL}/Apis/Home/getFrontEndPanels`, // order by priority must
      success: function(data) {
        if (data.length > 0) {

          // appointment form side bar #######################################################
          $("#appointment_steps_body").html($("#tmpl_appointment_steps_body").render(data.map((el, i) => {
            return {
              sno: i + 1,
              ...el
            }
          })));
          $("#appointment_steps_body").append( /*html*/ `
              <div class="appointment_step_element" id="step_finished" data-step-id="confirm_details" data-loader="card_${data.length + 1}" data-title="Confirm Details" style="display: block;">
                <span class="badge">${data.length + 1}</span>
                <span class="step_title"> Finished</span>
              </div>
            `);

          // process all steps ############################################################## 
          window.current_step = 1;
          window.data = data;

          // onclick step
          $('.next_step').on('click', () => nextStep());
          $('.prev_step').on('click', () => prevStep());
          $('.confirm_appointment').on('click', () => $('#form_information').find('[type="submit"]').trigger('click'));

          // initial step
          processOnchange(data[current_step - 1].step_name, data[current_step - 1].is_compulsory);

        } else {
          alert('something went wrong. try again later');
        }
      }
    });

  });

  function nextStep() {
    if (current_step < data.length) {
      current_step++;
      processOnchange(data[current_step - 1].step_name, data[current_step - 1].is_compulsory); // load api
      $(`#step_${data[current_step - 1].step_name}`).addClass('selected_step  active_step'); // next active
    } else if (current_step > data.length) {
      current_step++;
      processOnchange("confirm_details", true); // load api
      $(`#step_confirm_details`).addClass('selected_step  active_step'); // next active
    }
  }

  function prevStep() {
    if (current_step > 1) {
      current_step--;
      $('#appointment_container_header').text(`Select ${data[current_step - 1].step_name}`);
      $('.card_section').addClass('hidden');
      data[current_step - 1].is_compulsory ? $('.next_step').hide() : $('.next_step').show(); // show without load
      $(`#step_${data[current_step].step_name}`).removeClass('selected_step active_step'); // current inactive
    }

    // show again prev card
    $(`#card_${data[current_step - 1].step_name}`).removeClass('hidden');

    // hide if confirm page accur
    $('.confirm_appointment').addClass('hidden');

    // scroll hover
    if (!isMobileView()) {
      $(`.appointment_container_body`).niceScroll({
        cursorcolor: "#e4ebf4",
        bouncescroll: true
      });
    }
  }

  // ###############################################################################################################
  // process on change function to load item #######################################################################
  // ###############################################################################################################
  function processOnchange(section, is_compulsory) {

    let formData = {
      'location': isNum($('#card_location .item.card_selected').attr('data-id')),
      'staff': isNum($('#card_staff .item.card_selected').attr('data-id')),
      'service': isNum($('#card_service .item.card_selected').attr('data-id')),
    };

    $('#appointment_container_header').text(`Select ${section}`); // heading top section
    $('.card_section').addClass('hidden'); // hide all section to display one
    is_compulsory ? $('.next_step').hide() : $('.next_step').show(); // can skip or not

    if (section == 'location') {
      // card_location
      $.ajax({
        type: "GET",
        url: `${baseURL}/Apis/Home/getLocations`,
        contentType: "application/json",
        data: formData,
        beforeSend: function() {
          $('.preloader_card1_box').removeClass('hidden');
        },
        success: function(data) {
          $('.preloader_card1_box').addClass('hidden');
          $("#card_location").removeClass('hidden');
          $("#card_location").html($("#tmpl_card_location").render(data));
          itemClickToNext(section);
        }
      });

    } else if (section == 'staff') {

      // card_staff
      $.ajax({
        type: "GET",
        url: `${baseURL}/Apis/Home/getStaff`,
        contentType: "application/json",
        data: formData,
        beforeSend: function() {
          $('.preloader_card1_box').removeClass('hidden');
        },
        success: function(data) {
          $('.preloader_card1_box').addClass('hidden');
          $("#card_staff").removeClass('hidden');
          $("#card_staff").html($("#tmpl_card_staff").render(data));
          itemClickToNext(section);
        }
      });

    } else if (section == 'service') {

      // card_service
      $.ajax({
        type: "GET",
        url: `${baseURL}/Apis/Home/getServices`,
        contentType: "application/json",
        data: formData,
        beforeSend: function() {
          $('.preloader_card2_box').removeClass('hidden');
        },
        success: function(data) {
          $('.preloader_card2_box').addClass('hidden');
          $("#card_service").removeClass('hidden');
          $("#card_service").html($("#tmpl_card_service").render(data));
          itemClickToNext(section);
        }
      });

    } else if (section == 'datetime') {

      $("#card_datetime").removeClass('hidden');

    } else if (section == 'information') {

      $("#card_information").removeClass('hidden');
      $('.confirm_appointment').removeClass('hidden');

    }

  } // processOnchange end

  function itemClickToNext(section) {
    // onclick select and next
    $(`#card_${section} .item`).on('click', function() {
      $(`#card_${section} .item`).removeClass('card_selected'); // remove all this section select
      $(this).addClass('card_selected'); // select the clicked item
      nextStep(); // next after selecting item
    });

    // scroll hover
    if (!isMobileView()) {
      $(`.appointment_container_body`).niceScroll({
        cursorcolor: "#e4ebf4",
        bouncescroll: true
      });
    }
  }

  // #################################################################################################################
  // form submission function ########################################################################################
  // #################################################################################################################
  $('#form_information').on('submit', function(e) {

    e.preventDefault();

    let formData = {

      // ids
      'location': isNum($('#card_location .item.card_selected').attr('data-id')),
      'staff': isNum($('#card_staff .item.card_selected').attr('data-id')),
      'service': isNum($('#card_service .item.card_selected').attr('data-id')),

      // datetime appointment
      'date': $('.td.calendar_days.calendar_selected_day').attr('data-date'),
      'time': $('.selected_time').attr('data-time'),

      // information
      'first_name': $('#first_name').val(),
      'last_name': $('#last_name').val(),
      'date_of_birth': moment($('#date_of_birth').val()).format('YYYY-MM-DD'),
      'country_id': $('#country_id').val(),
      'mobile_number': $('#mobile_number').val(),
      'emirates': $('#emirates').val(),
      'email': $('#email').val(),
      'marital_status': $('#marital_status').val(),
    };

    // card_service
    $.ajax({
      type: "POST",
      url: `${baseURL}/Apis/Home/createAppointment`,
      contentType: false,
      processData: false,
      data: JSON.stringify(formData),
      beforeSend: function() {
        // begin:loader
        $('#card_information').addClass('hidden');
        $('.preloader_card2_box').removeClass('hidden');
        $('.confirm_appointment').attr('disabled', true);
        // end:loader
      },
      success: function(data) {
        if (data && data.status) {

          // begin:loader
          $('#card_information').removeClass('hidden');
          $('.preloader_card2_box').addClass('hidden');
          $('.confirm_appointment').attr('disabled', false);
          // end:loader

          $('.appointment_finished_code').html(`${data.result.customer_id}${data.result.appointment_id}`);
          $('#appointment_container_header').text(`Finished`); // heading top section
          $('.appointment_container').addClass('hidden'); // hide all section to display one
          $('.appointment_finished').attr('style', 'display:flex'); // hide all section to display one
          $('#step_finished').addClass('selected_step active_step'); // current active
        }
      }
    });


  });
</script>